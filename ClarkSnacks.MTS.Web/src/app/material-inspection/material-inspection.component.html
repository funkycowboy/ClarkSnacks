<h2>Material Inspection Form</h2>

<!-- Step1 : Shipment Information -->
<p style="font-weight:bold"><span class="ui-state-default fa fa-arrow-circle-right"></span> Step 1. Provide the following shipment information.</p>

<form [formGroup]="inspectionForm" (ngSubmit)="onSubmit(inspectionForm.value)">

  <div class="ui-g" style="background-color: #ececec; border-radius:5px;">

    <div class="ui-g-12">
      <div class="ui-g-3 ui-lg-3 ui-md-6 ui-sm-12">
        <label for="Item">Shipment Received Date: </label>
      </div>
      <div class="ui-g-4 ui-lg-3 ui-md-6 ui-sm-12">
        <p-calendar formControlName="dateReceived" name="DateReceived" [(ngModel)]="selectedDateReceived" showIcon="true" readonlyInput="true"></p-calendar>
      </div>
      <div class="ui-g-3 ui-lg-3 ui-md-6 ui-sm-12">
        <label for="Item">BOL/Shipment Number: </label>
      </div>
      <div class="ui-g-2 ui-lg-3 ui-md-6 ui-sm-12">
        <input formControlName="bolShipmentNumber" #bolshipmentnumber type="text" pInputText />
      </div>
    </div>

    <div class="ui-g-12">
      <div class="ui-g-3 ui-lg-3 ui-md-6 ui-sm-12">
        <label for="Supplier">Shipment Supplier: </label>
      </div>
      <div class="ui-g-2 ui-lg-3 ui-md-6 ui-sm-12">
        <p-dropdown formControlName="supplier" name="Supplier" [options]="supplierOptions" [(ngModel)]="selectedSupplier"></p-dropdown>
      </div>
      <div class="ui-g-3 ui-lg-3 ui-md-6 ui-sm-12">
        <label for="ApprovedSupplier">Is the supplier an approved supplier?</label>
      </div>
      <div class="ui-g-4 ui-lg-3 ui-md-6 ui-sm-12">
        <p-inputSwitch formControlName="approvedSupplier" name="ApprovedSupplier" [(ngModel)]="approvedSupplierChecked"></p-inputSwitch>
      </div>
    </div>
  </div>

  <div class="ui-g">
    <div class="ui-g-12" style="text-align: right">
      <button pButton type="button" icon="fa fa-arrow-circle-right" label="Continue to Step 2" (click)="goToStep2()"></button>
    </div>
  </div>

  <!-- Step 2: Item and Lot Number Information -->
  <div formGroupName="inspectionFormStep2" *ngIf="showStep2">
    <p style="font-weight:bold"><span class="ui-state-default fa fa-arrow-circle-right"></span> Step 2. Provide the following shipping item and lot information.</p>

    <p-table #dt [value]="inspections" dataKey="id" editMode="row" [responsive]="true">
      <ng-template pTemplate="header">
        <tr>
          <th>Item</th>
          <th>Lot Numbers</th>
          <th></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-inspection let-rowData let-editing="editing" let-ri="rowIndex">
        <tr [pEditableRow]="rowData">
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown (onChange)="itemTypeChange($event)" formControlName="item" [options]="itemTypeOptions" [(ngModel)]="inspection.item.name"></p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{inspection.item.name}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div style="display: inline-block; vertical-align:middle">
                  <p-chips (onAdd)="lotNumbersChange($event)" formControlName="lotNumbers" [(ngModel)]="inspection.lotNumbers"></p-chips>
                </div>
                <div style="display: inline-block;vertical-align:middle; margin-left: 10px;">
                  <button class="ui-button-rounded ui-button-secondary" type="button" pButton icon="fa fa-info" pTooltip="Press ENTER on your keybord after each lot number entered."></button>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                {{inspection.lotNumbers}}
              </ng-template>
            </p-cellEditor>
          </td>
          <td style="text-align:center">
            <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInit(rowData)"></button>
            <button *ngIf="editing" pButton type="button" pSaveEditableRow icon="pi pi-check" class="ui-button-success" style="margin-right: .5em" (click)="onRowEditSave(rowData)"></button>
            <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancel(rowData, ri)"></button>
          </td>
        </tr>
      </ng-template>
      <!--<ng-template pTemplate="footer">
        <tr>
          <td colspan="3">
            <div style="text-align: right">
              <button [table]="dt" class="ui-button-rounded ui-button-secondary" pAddRow type="button" pButton icon="fa fa-plus" label="Add Item" [newRow]="addNewTableRow()"></button>
            </div>
          </td>
        </tr>
      </ng-template>-->
    </p-table>
    <div class="ui-g">
      <div class="ui-g-12" style="text-align: right">
        <button pButton type="button" icon="fa fa-arrow-circle-right" label="Continue to Step 3" (click)="goToStep3()" [disabled]="!selectedItemType || !selectedLotNumbers"></button>
      </div>
    </div>
  </div>

  <!-- Step 3: Inspection QUestions -->

  <div *ngIf="showStep3">
    <p style="font-weight:bold">
      <span class="ui-state-default fa fa-arrow-circle-right"></span>
      Step 3: Answer the following {{selectedItemType}} inspection questions with a Yes, No or N/A.
    </p>
  </div>

  <div formGroupName="inspectionFormStep3" style="background-color: #ececec; border-radius: 5px">

    <!-- Inspection Criteria - Bags -->

    <div class="ui-g" *ngIf="selectedItemType == 'Bag' && showStep3">

      <div class="ui-g-12">
        <div class="ui-g-8">Is the trailer inspection complete and the trailer acceptable for receipt? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ1" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the load in good condition (no damage, stretch wrap intact, no signs of pest activity or water damage)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ2" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the quantity adequate to the quantity ordered? (Clarkâ€™s Purchased Items Only)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ3" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Do the item numbers, quantities, tracking numbers (lot) of physical receipt match the Bill of Lading?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ4" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Are the individual cases of bags marked with item number and tracking number (lot)?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ5" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is a Certificate of Conformance available for each item & lot on the shipment?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ6" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the Certificate of Conformance acceptable? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ7" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Have 3 samples been collected from each item?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ8" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the bag printing match the standard on file, in regards to quality (print is clear and readable) & accuracy (print is identical to standard)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ9" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the bag construction match the standard on file, in regards to physical characteristics (paper type, size) functionality (gusset, glue, bottom seal)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeBagQ10" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

    </div>

    <!-- Inspection Criteria - Cartons -->

    <div class="ui-g" *ngIf="selectedItemType == 'Carton' && showStep3">

      <div class="ui-g-12">
        <div class="ui-g-8">Is the trailer inspection complete and the trailer acceptable for receipt? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ1" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the load in good condition (no damage, stretch wrap intact, no signs of pest activity or water damage)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ2" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the quantity adequate to the quantity ordered? (Clarkâ€™s Purchased Items Only)?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ3" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Do the item numbers and quantities of physical receipt match the Bill of Lading?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ4" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Are the individual cases of cartons marked with item number?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ5" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Have 3 samples been collected from each item?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ6" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the carton printing match the standard on file, in regards to quality (print is clear and readable) & accuracy (print is identical to standard, especially net weight & allergen/ingredient statements)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ7" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the carton construction match the standard on file, in regards to physical characteristics (paper type, size, coatings) and functionality (flaps, glue, scoring)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeCartonQ8" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

    </div>

    <!-- Inspection Criteria - Overwrap Film -->

    <div class="ui-g" *ngIf="selectedItemType == 'Overwrap Film' && showStep3">

      <div class="ui-g-12">
        <div class="ui-g-8">Is the trailer inspection complete and the trailer acceptable for receipt? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ1" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the load in good condition (no damage, stretch wrap intact, no signs of pest activity or water damage)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ2" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the quantity adequate to the quantity ordered? (Clarkâ€™s Purchased Items Only)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ3" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Do the item numbers, quantities, tracking numbers (lot) of physical receipt match the Bill of Lading?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ4" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Are the cores marked with item number and quantity?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ5" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Have 3 samples been collected from each item?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ6" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the overwrap printing match the standard on file, in regards to quality (print is clear and readable) & accuracy (print is identical to standard, especially net weight & allergen/ingredient statements)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ7" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the overwrap construction match the standard on file, in regards to physical characteristics (film type, size, coatings) and functionality (seal area free of coating, wind direction is correct)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeOverwrapFilmQ8" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

    </div>

    <!-- Inspection Criteria - COntact Film -->

    <div class="ui-g" *ngIf="selectedItemType == 'Contact Film' && showStep3">

      <div class="ui-g-12">
        <div class="ui-g-8">Is the trailer inspection complete and the trailer acceptable for receipt? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ1" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the load in good condition (no damage, stretch wrap intact, no signs of pest activity or water damage)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ2" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the quantity adequate to the quantity ordered? (Clarkâ€™s Purchased Items Only)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ3" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Do the item numbers, quantities, tracking numbers (lot) of physical receipt match the Bill of Lading?  </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ4" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Are the rolls marked with item number, tracking number and quantity of impressions?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ5" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is a Certificate of Conformance available for each item & lot on the shipment?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ6" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Is the Certificate of Conformance acceptable?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ7" [options]="resultOptions"></p-selectButton>
        </div>
      </div>


      <div class="ui-g-12">
        <div class="ui-g-8">Has 1 impression been collected for each item?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ8" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the film printing match the standard on file, in regards to quality (print is clear and readable) & accuracy (print is identical to standard)?</div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ9" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

      <div class="ui-g-12">
        <div class="ui-g-8">Does the film construction match the standard on file, in regards to physical characteristics (film type, width, thickness)? </div>
        <div class="ui-g-3" style="white-space: nowrap">
          <p-selectButton formControlName="itemTypeContactFilmQ10" [options]="resultOptions"></p-selectButton>
        </div>
      </div>

    </div>

    <div class="ui-g-12" style="text-align: right" *ngIf="['Contact Film','Overwrap Film','Bag','Carton'].indexOf(selectedItemType) > -1 && showStep3">
      <div class="ui-g-1"></div>
      <div class="ui-g-8"></div>
      <div class="ui-g-3" style="white-space: nowrap">
        <button type="submit" pButton icon="fa fa-arrow-circle-right" [disabled]="!inspectionForm.valid" label="Continue"></button>
      </div>
    </div>

  </div>

</form>

<!-- Inspection Result Modal -->

<p-dialog header="Confirm Inspection" [(visible)]="displayDialog" [focusOnShow]="true" [responsive]="true" showEffect="fade" [modal]="true">
  <div class="ui-g ui-fluid">
    <div class="ui-g-12">
      <div class="ui-g-4">
        <label for="name">Select an inspection result:</label>
      </div>
      <div class="ui-g-8">
        <span style="font-size:12px; font-weight: bold">{{resultDescription}}</span>
        <p-selectButton name="InspectionResult" [options]="overallResultOptions" [(ngModel)]="selectedOverallResult" (onChange)="showDescription($event)"></p-selectButton>
      </div>
    </div>
    <div *ngIf="selectedOverallResult.code == 'rejected' || selectedOverallResult.code == 'deviation'">
      <p style="font-weight: bold">Please provide the additional information below.</p>
    </div>
    <div class="ui-g-12" *ngIf="selectedOverallResult.code == 'rejected'">
      <div class="ui-g-4">
        <label for="name">Disposition:</label>
      </div>
      <div class="ui-g-8">
        <p-dropdown name="Disposition" [options]="dispositionOptions" [(ngModel)]="selectedSupplier"></p-dropdown>
      </div>
    </div>
    <div class="ui-g-12" *ngIf="selectedOverallResult.code == 'deviation'">
      <div class="ui-g-4">
        <label for="name">Deviation #:</label>
      </div>
      <div class="ui-g-8">
        <input #deviationnumber type="text" pInputText />
      </div>
    </div>
    <div class="ui-g-12" *ngIf="selectedOverallResult.code == 'rejected' || selectedOverallResult.code == 'deviation'">
      <div class="ui-g-4">
        <label for="name">Hold Status:</label>
      </div>
      <div class="ui-g-8">
        <p-dropdown name="HoldStatus" [options]="holdStatusOptions" [(ngModel)]="selectedSupplier"></p-dropdown>
      </div>
    </div>
    <div class="ui-g-12" *ngIf="selectedOverallResult && selectedOverallResult.code != 'accepted'">
      <div class="ui-g-4">
        <label for="name">Measure(s) to prevent release:</label>
      </div>
      <div class="ui-g-8">
        <textarea pInputTextarea></textarea>
      </div>
    </div>
  </div>

  <p-footer>
    <button type="button" pButton icon="fa fa-times" label="Cancel" (click)="cancel()"></button>&nbsp;
    <button type="button" pButton icon="fa fa-check" label="Save" (click)="save()"></button>
  </p-footer>
</p-dialog>


